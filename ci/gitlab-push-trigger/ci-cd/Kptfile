apiVersion: kpt.dev/v1
kind: Kptfile
metadata:
  name: ci-cd
  annotations:
    config.kubernetes.io/local-config: "true"
  labels:
    app: axyom-backstage-provider-tekton
    app.kubernetes.io/managed-by: kpt
    app.kubernetes.io/name: axyom-backstage-provider-tekton
    app.kubernetes.io/part-of: axyomcore-portal
info:
  description: Deploy Tekton CI/CD pipelines for axyomcore-backstage-provider
  site: axyomcore-portal.apps.ci-cd.casa.dev
  keywords:
    - backstage
    - portal
    - entity
    - provider
    - tekton
    - pipelines
pipeline:
  mutators:
    - name: set labels
      image: gcr.io/kpt-fn/set-labels:v0.2.0
      configMap:
        app: axyom-backstage-provider-tekton
        app.kubernetes.io/managed-by: kpt
        app.kubernetes.io/name: axyom-backstage-provider-tekton
        app.kubernetes.io/part-of: axyomcore-portal
    - name: set namespace
      image: gcr.io/kpt-fn/set-namespace:v0.4.1
      configMap:
        namespace: axyomcore-portal
  validators:
    - name: validate manifests
      image: 'gcr.io/kpt-fn/kubeval:v0.3.0'
      configMap:
        skip_kinds: 'Route,ResourceGroup'
        strict: "true"
        ignore_missing_schemas: "true"
